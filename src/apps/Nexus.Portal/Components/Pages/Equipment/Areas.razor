@page "/equipment/areas"
@using MudBlazor
@using MudBlazor.Components
@using Nexus.Core.Domain.Models.Areas
@using Nexus.Core.Domain.Models.Areas.Enums
@inject Nexus.Core.Domain.Models.Areas.Interfaces.IAreaRepository AreaRepository

<PageTitle>Area Management</PageTitle>

<MudContainer MaxWidth="MaxWidth.Medium" Class="mt-4">
    <MudText Typo="Typo.h3" GutterBottom="true">Area Management</MudText>
    <MudText Typo="Typo.subtitle1" Class="mb-4">Manage areas and their current status</MudText>

    <MudCard>
        <MudCardHeader>
            <CardHeaderContent>
                <MudText Typo="Typo.h6">Area List</MudText>
            </CardHeaderContent>
        </MudCardHeader>
        <MudCardContent>
            <MudTable Items="@_areas" Hover="true" Breakpoint="Breakpoint.Sm">
                <HeaderContent>
                    <MudTh>Area ID</MudTh>
                    <MudTh>Name</MudTh>
                    <MudTh>Status</MudTh>
                    <MudTh>Actions</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Area ID">@context.Id</MudTd>
                    <MudTd DataLabel="Name">@context.Name</MudTd>
                    <MudTd DataLabel="Status">
                        <MudChip T="string" Color="@GetStatusColor(context.Status)" Size="Size.Small">@context.Status</MudChip>
                    </MudTd>
                    <MudTd DataLabel="Actions">
                        <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small">View Details</MudButton>
                    </MudTd>
                </RowTemplate>
            </MudTable>
        </MudCardContent>
    </MudCard>
</MudContainer>

<Nexus.Portal.Components.Layout.DockPortal>
    <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween" Class="mb-1">
        <MudText Typo="Typo.subtitle2">Area Summary</MudText>
    </MudStack>

    <MudDataGrid T="Area"
                 Items="_areas"
                 Dense="true"
                 Hover="true"
                 Bordered="true"
                 Striped="true"
                 FixedHeader="true"
                 RowsPerPage="10"
                 Virtualize="false"
                 ReadOnly="true"
                 Hideable="true">
        <Columns>
            <PropertyColumn Property="x => x.Id" Title="Area ID" Sortable="true" />
            <PropertyColumn Property="x => x.Name" Title="Name" Sortable="true" />
            <PropertyColumn Property="x => x.ParentId" Title="Parent ID" Sortable="true" />
            <TemplateColumn Title="Visible" Sortable="true">
                <CellTemplate>
                    @(context.Item.IsVisible ? "Yes" : "No")
                </CellTemplate>
            </TemplateColumn>
            <TemplateColumn Title="Status" Sortable="true">
                <CellTemplate>
                    <MudChip T="string" Color="@GetStatusColor(context.Item.Status)" Size="Size.Small">@context.Item.Status</MudChip>
                </CellTemplate>
            </TemplateColumn>
        </Columns>

        <PagerContent>
            <MudDataGridPager />
        </PagerContent>
    </MudDataGrid>
</Nexus.Portal.Components.Layout.DockPortal>

@code {
    private IReadOnlyList<Area> _areas = Array.Empty<Area>();

    protected override async Task OnInitializedAsync()
    {
        IReadOnlyList<Area> areas = await AreaRepository.GetAllAsync();
        _areas = areas;
    }

    private Color GetStatusColor(EAreaStatus status)
    {
        if (status == EAreaStatus.InUse)
        {
            return Color.Success;
        }
        if (status == EAreaStatus.Idle)
        {
            return Color.Info;
        }
        if (status == EAreaStatus.Reserved)
        {
            return Color.Secondary;
        }
        if (status == EAreaStatus.Maintenance)
        {
            return Color.Warning;
        }
        if (status == EAreaStatus.Disabled)
        {
            return Color.Error;
        }
        return Color.Default;
    }
}
