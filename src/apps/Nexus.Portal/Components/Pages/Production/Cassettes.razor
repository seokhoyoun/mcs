@page "/production/cassettes"
@using Nexus.Core.Domain.Models.Locations.Interfaces
@using Nexus.Core.Domain.Models.Transports
@using Nexus.Core.Domain.Models.Transports.Interfaces
@using Nexus.Core.Domain.Models.Locations
@using Nexus.Core.Domain.Models.Locations.Services
@inject ITransportsRepository TransportsRepo
@* @inject ILocationService LocationService  *@

<PageTitle>Cassettes</PageTitle>

<MudPaper Class="pa-4">
    <MudText Typo="Typo.h5">Cassette Explorer</MudText>

    <MudTable Items="cassettes" Dense="true" Hover="true" Bordered="true" Striped="true">
        <HeaderContent>
            <MudTh>Id</MudTh>
            <MudTh>Name</MudTh>
            <MudTh>Transport Type</MudTh>
            <MudTh>Tray Count</MudTh>
            <MudTh>Location</MudTh>
            <MudTh>Status</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd>@context.Id</MudTd>
            <MudTd>@context.Name</MudTd>
            <MudTd>@context.TransportType</MudTd>
            <MudTd>@context.Trays.Count</MudTd>
            <MudTd>@* @GetLocationName(context.Id) *@</MudTd>
            <MudTd>@* @GetLocationStatus(context.Id) *@</MudTd>
        </RowTemplate>
      
    </MudTable>
</MudPaper>

@code {
    private List<Cassette> cassettes = new();

    protected override async Task OnInitializedAsync()
    {
        var all = await TransportsRepo.GetAllAsync();
        if (all.Count == 0)
        {
            await TransportsRepo.AddAsync(new Cassette("CS-001", "Cassette 1", new List<Tray>())); 
            all = await TransportsRepo.GetAllAsync();
        }

        cassettes = all.OfType<Cassette>().ToList();
    
    }

    private string GetLocationName(string cassetteId)
    {
        return null;
        // var loc = LocationService.GetCassetteLocationById(cassetteId);
        // return loc?.Name ?? "-";
    }

    private string GetLocationStatus(string cassetteId)
    {
        return null;
        // var loc = LocationService.GetCassetteLocationById(cassetteId);
        // return loc?.Status.ToString() ?? "-";
    }
}
